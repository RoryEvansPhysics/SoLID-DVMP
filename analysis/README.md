# Work-Flow to perform DVMP Simualtion with SoLID
## -- Zhihong Ye 04/19/2017

## Summary of the analysis work-flow:
 * Step#1: Read in all generated MC events, add SoLID acceptance and resolution, calculate rate, calculate missing mass and momentum
```js
./AddBranch
```
 * Step#2: Read files generated by AddBranch, and split into smaller root-files based on "t" or "tp" binning
```js
./skim
```
 * Step#3: in ./asym_extr/, Using Unbinned-Maximum-Likelihood with TMinuit fitting method to extract different asymmetries (Note: to fit successfully, in the polarization down configuration, we need to rotate the phiS (+PI) just like real experiment, instead of flipping the polarization sign)
```js
./FitMinuit
```
 * Step#4: in ./missing_mass/, Plotting missing mass and momentum spectra with SIDIS and DEMP events
```js
./Missing_Mass
```
 * Step#5: in ./makebin/, Bin the MC data in each t or tp bin futher in (Phi, PhiS) bin, calculate the sum of asymmetries for comparision, and also calcualte the goodness of the fit to check the quality. Output both histograms and data files for plottings. (Note: for up quark, I flip the polarization sign for polarization-down instead of rotating phiS since we compare the same phiS values)
 ```js
    ./makebin
    notebook AsymFit_Binned.ipynb
 ```

## Generate DVMP Simulated Events -- by Zafar Ahmed
### There are few different version of the MC events

  * Clean events w/o any effects
  * Add Fermi-Motion of neutrons in th etarget
  * Add Final-State-Interaction of outgoing pion
  * Add Energy-Loss and Multiple-Scattering effects of incoming and outgoing electrons, pion and proton

### Generated events with target polarization UP and DOWN separately
### Calculate total cross sections (dXS=dXS_UU+dXS_UT), where six different UT terms based on different angular modules are also given
### Every quantity is save in the lab frame


## Add SoLID Acceptance, Resolution and Missing Mass info in the rootfile
### The code "AddBranch.C" does this job and it also only saves events with Q2>4 GeV^2

 * SoLID Acceptance is given in histograms which were generated by runing GEMC simulation
 * SoLID detector resolutions are added by giveing the resolution of momenta, scattered angles and azimuthal angles for all three final state particles
 * Note to use the "corrected" quantities(p, theta,phi) in the lab frame to obtain the acceptances
 * When reconstructing missing mass and momentum, use the "corrected"+"resolution smeared" quantities
 * To avoid confusion, different polarized XS and weights were recalculated based on the asymmetries

## Plot Missing Mass and Momentum Spectra with DEMP and SIDIS events
### The code "./missing_mass/Missing_Mass.C" does this job

### Use the code "./makebin/skim.C" to dvidie the root files into small files for individual -t bins or -tp bins
 * Names correspond to different configurations:
 ```js
    simple->No Fermi, EL, MS, FSI
    fermi->Only Fermi
    mult_nofermi-> EL, MS, but not Fermi
    mult-> Fermi, EL, MS
    mult_fsi-> Fermi, EL, MS, FSI
 ```
 * If binning on "t", using the following boundry:
```js
    t_cut[8] = {0.05, 0.20, 0.30, 0.40, 0.50, 0.70, 1.00, 3.0};
```
 * If binning on "tp", using the following boundry:
```js
    tp_cut[10] = {0.0,0.025,0.05,0.075,0.100, 0.150,0.200,0.250,0.350,0.7};
```
 * If binning on "log10(tp)", using the following boundry:
```js
    tp_cut[10] = {-5.0, -2.4, -2.0, -1.8, -1.6, -1.4, -1.2, -0.8, -0.6, -0.2};
```

## Reconstruct "Experimental" Asymmetry and perform fitting to extract angular modulations.
### The code "./asym_extr/FitMinuit.C" does the job with the TMinuitpackage.
 * It is a unbinned Maximin-Likelihood Minuit method
 
## Perform Binning on Phi and PhiS for plotting
### The code "./makebin/makebin.C" does the job
